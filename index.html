<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eisenhower-Matrix</title>

  <style>
    :root{
      --bg:#0b1020;
      --text:#e9ecff;
      --muted:#aab2e6;
      --line: rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --r:18px;

      --accent:#6ea8ff;
      --ok:#2dd4bf;
      --warn:#fbbf24;
      --bad:#fb7185;
      --neutral:#9ca3af;

      --q1:#fb7185;  /* rot */
      --q2:#fbbf24;  /* gelb */
      --q3:#2dd4bf;  /* grÃ¼n */
      --q4:#9ca3af;  /* grau */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 10% 0%, rgba(110,168,255,.18), transparent 55%),
        radial-gradient(900px 500px at 90% 10%, rgba(45,212,191,.12), transparent 55%),
        radial-gradient(900px 500px at 50% 100%, rgba(251,113,133,.10), transparent 55%),
        var(--bg);
      color: var(--text);
    }

    .wrap{ max-width:1100px; margin:0 auto; padding:18px 14px 96px; }
    header{ display:flex; gap:12px; align-items:flex-start; justify-content:space-between; margin-bottom:14px; }
    .title{ display:flex; flex-direction:column; gap:6px; }
    h1{ margin:0; font-size:22px; letter-spacing:.2px; line-height:1.15; }
    .sub{ margin:0; color:var(--muted); font-size:13px; }

    .status{ display:flex; flex-direction:column; align-items:flex-end; gap:6px; min-width:200px; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      border-radius:999px; font-size:12px; color:var(--muted);
      box-shadow: var(--shadow); backdrop-filter: blur(8px);
    }
    .dot{ width:10px; height:10px; border-radius:50%; background: var(--neutral); box-shadow: 0 0 0 4px rgba(156,163,175,.14); }

    .grid{ display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width: 860px){ .grid{ grid-template-columns:1fr 1fr; } h1{ font-size:26px; } }

    .card{
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      background: rgba(255,255,255,.04);
    }

    .cardHead{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 12px 10px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.14);
    }

    .label{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .cardHead strong{ font-size:14px; letter-spacing:.2px; }
    .hint{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .colorBadge{
      width:14px; height:14px; border-radius:6px;
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 0 0 4px rgba(255,255,255,.06);
      flex:0 0 auto;
    }

    .cardBody{ padding:12px; display:flex; flex-direction:column; gap:10px; }

    .q1 { background: linear-gradient(180deg, rgba(251,113,133,.14), rgba(255,255,255,.03)); }
    .q2 { background: linear-gradient(180deg, rgba(251,191,36,.14), rgba(255,255,255,.03)); }
    .q3 { background: linear-gradient(180deg, rgba(45,212,191,.14), rgba(255,255,255,.03)); }
    .q4 { background: linear-gradient(180deg, rgba(156,163,175,.14), rgba(255,255,255,.03)); }

    .addRow{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .addRow input[type="text"]{
      flex: 1 1 240px;
      min-width: 160px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      outline:none;
    }
    .addRow input[type="date"],
    .addRow input[type="time"],
    .addRow input[type="number"]{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      outline:none;
    }
    .addRow input[type="number"]{ width: 110px; }

    button{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      cursor: pointer;
      transition: transform .06s ease, background .12s ease, border-color .12s ease, opacity .12s ease;
    }
    button:active{ transform: translateY(1px); }
    button:hover{ background: rgba(255,255,255,.12); }
    .primary{ border-color: rgba(110,168,255,.45); background: rgba(110,168,255,.18); }
    .primary:hover{ background: rgba(110,168,255,.24); }
    .ghost{ background: transparent; }
    .iconBtn{ padding:8px 10px; border-radius: 12px; font-size: 13px; line-height: 1; }
    .danger:hover{ border-color: rgba(251,113,133,.55); background: rgba(251,113,133,.12); }

    ul.tasks{
      list-style:none; padding:0; margin:0;
      display:flex; flex-direction:column; gap:8px;
      min-height: 40px;
    }

    li.task{
      display:flex; gap:10px; align-items:flex-start;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: 14px;
      padding: 10px 10px;
    }

    li.task.dragging{ opacity:.55; }
    ul.tasks.dropTarget{ outline: 2px dashed rgba(110,168,255,.35); outline-offset: 6px; border-radius: 14px; }

    .tLeft{ display:flex; gap:10px; align-items:flex-start; flex:1 1 auto; min-width:0; }
    .tLeft input[type="checkbox"]{ width:18px; height:18px; margin-top:2px; accent-color: var(--accent); }
    .tTextWrap{ display:flex; flex-direction:column; gap:4px; min-width:0; flex:1 1 auto; }
    .tText{ font-size: 14px; line-height:1.25; overflow-wrap:anywhere; }
    .tMeta{ font-size:12px; color: var(--muted); display:flex; gap:10px; flex-wrap:wrap; }
    .done .tText{ text-decoration: line-through; opacity: .65; }
    .done{ opacity: .92; }

    .tRight{ display:flex; gap:6px; align-items:center; flex:0 0 auto; }

    .footerBar{
      position: fixed; left:0; right:0; bottom:0;
      background: rgba(10,14,30,.78);
      border-top: 1px solid var(--line);
      backdrop-filter: blur(10px);
      padding: 10px 12px;
      z-index: 999;
      transform: translateY(110%);
      transition: transform .18s ease;
    }
    .footerBar.open{ transform: translateY(0); }

    .barInner{
      max-width: 1100px;
      margin: 0 auto;
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
      justify-content:space-between;
    }
    .btnRow{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .rightInfo{ display:flex; gap:10px; align-items:center; color: var(--muted); font-size: 12px; }
    .toggle{
      display:flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.06);
    }
    input[type="checkbox"].toggleCbx{ width:18px; height:18px; accent-color: var(--accent); }

    .fab{
      position: fixed;
      right: 14px;
      bottom: 14px;
      z-index: 1000;
      border-radius: 999px;
      padding: 12px 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .fab:active{ transform: translateY(1px); }
    .smallLink{ color: var(--muted); text-decoration: underline; cursor:pointer; user-select:none; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Eisenhower-Matrix</h1>
        <p class="sub">Sortiert nach Datum+Uhrzeit. Drag&Drop zwischen Quadranten. ðŸ“… Ã¶ffnet Google Kalender mit Start/Ende.</p>
      </div>
      <div class="status">
        <div class="pill"><span class="dot" id="dot"></span><span id="saveState">bereit</span></div>
        <div class="pill">zuletzt gespeichert: <span id="lastSaved">â€“</span></div>
      </div>
    </header>

    <div class="grid" id="grid"></div>
  </div>

  <button class="fab" id="menuBtn" aria-label="MenÃ¼ Ã¶ffnen/schlieÃŸen">MenÃ¼</button>

  <div class="footerBar" id="footer">
    <div class="barInner">
      <div class="btnRow">
        <button class="primary" id="saveBtn">Speichern</button>
        <button id="exportBtn">Export (JSON)</button>
        <button id="importBtn">Import (JSON)</button>
        <input id="fileInput" type="file" accept="application/json" hidden />
        <button class="ghost" id="clearBtn" title="LÃ¶scht nur lokale Daten dieser Seite">Alles leeren</button>
      </div>

      <div class="rightInfo">
        <div class="toggle" title="Speichert automatisch nach kurzer Pause">
          <input class="toggleCbx" type="checkbox" id="autosave" checked />
          <label for="autosave">Autosave</label>
        </div>
        <span class="smallLink" id="aboutLink">Info</span>
      </div>
    </div>
  </div>

<script>
  const STORAGE_KEY = "eisenhower_matrix_tasks_v3";

  const QUADS = [
    { key:"q1", title:"Wichtig & dringend", hint:"Sofort erledigen", colorVar:"--q1", className:"q1" },
    { key:"q2", title:"Wichtig & nicht dringend", hint:"Planen / terminieren", colorVar:"--q2", className:"q2" },
    { key:"q3", title:"Nicht wichtig & dringend", hint:"Delegieren / schnell abarbeiten", colorVar:"--q3", className:"q3" },
    { key:"q4", title:"Nicht wichtig & nicht dringend", hint:"Streichen / spÃ¤ter", colorVar:"--q4", className:"q4" },
  ];

  const els = {
    grid: document.getElementById("grid"),
    saveBtn: document.getElementById("saveBtn"),
    exportBtn: document.getElementById("exportBtn"),
    importBtn: document.getElementById("importBtn"),
    fileInput: document.getElementById("fileInput"),
    clearBtn: document.getElementById("clearBtn"),
    autosave: document.getElementById("autosave"),
    saveState: document.getElementById("saveState"),
    lastSaved: document.getElementById("lastSaved"),
    dot: document.getElementById("dot"),
    aboutLink: document.getElementById("aboutLink"),
    menuBtn: document.getElementById("menuBtn"),
    footer: document.getElementById("footer"),
  };

  function uid(){ return Math.random().toString(16).slice(2) + Date.now().toString(16); }
  function nowHHMM(){
    const d=new Date();
    return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0");
  }

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    }catch{ return null; }
  }

  function defaultState(){
    return { version:3, _lastSaved:null, _seq:0, q1:[], q2:[], q3:[], q4:[] };
  }

  let state = loadState() || defaultState();

  function setSavingUi(mode){
    els.saveState.textContent = mode;
    if (mode==="gespeichert"){
      els.dot.style.background = "var(--ok)";
      els.dot.style.boxShadow = "0 0 0 4px rgba(45,212,191,.14)";
    } else if (mode==="speichereâ€¦"){
      els.dot.style.background = "var(--warn)";
      els.dot.style.boxShadow = "0 0 0 4px rgba(251,191,36,.14)";
    } else if (mode==="ungespeichert"){
      els.dot.style.background = "var(--bad)";
      els.dot.style.boxShadow = "0 0 0 4px rgba(251,113,133,.14)";
    } else {
      els.dot.style.background = "var(--neutral)";
      els.dot.style.boxShadow = "0 0 0 4px rgba(156,163,175,.14)";
    }
  }

  function saveStateToStorage({quiet=false}={}){
    setSavingUi("speichereâ€¦");
    state._lastSaved = nowHHMM();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    els.lastSaved.textContent = state._lastSaved;
    setSavingUi("gespeichert");
    if (!quiet) openFooterTemporarily();
  }

  let t=null;
  function markDirtyAndMaybeAutosave(){
    setSavingUi("ungespeichert");
    if (!els.autosave.checked) return;
    clearTimeout(t);
    t=setTimeout(()=>saveStateToStorage({quiet:true}), 500);
  }

  function dueTimeSortKey(task){
    // ohne Datum -> ganz nach unten
    const d = task.due || "9999-99-99";
    const tm = task.time || "99:99";
    return `${d}T${tm}`;
  }

  function sortTasks(arr){
    return [...arr].sort((a,b)=>{
      const ka = dueTimeSortKey(a);
      const kb = dueTimeSortKey(b);
      if (ka<kb) return -1;
      if (ka>kb) return 1;
      const oa = (a.order ?? 0);
      const ob = (b.order ?? 0);
      return oa - ob;
    });
  }

  function ensureOrder(task){
    if (typeof task.order === "number") return;
    state._seq = (state._seq || 0) + 1;
    task.order = state._seq;
  }

  function toGoogleDateTimeUTC(dateStr, timeStr){
    // Google akzeptiert YYYYMMDDTHHMMSSZ (UTC). Wir konvertieren lokale Zeit -> UTC.
    // dateStr: YYYY-MM-DD, timeStr: HH:MM
    const [y,m,d] = dateStr.split("-").map(Number);
    const [hh,mm] = timeStr.split(":").map(Number);
    const local = new Date(y, (m-1), d, hh, mm, 0);
    const pad = (n)=> String(n).padStart(2,"0");
    const utc =
      String(local.getUTCFullYear()).padStart(4,"0") +
      pad(local.getUTCMonth()+1) +
      pad(local.getUTCDate()) + "T" +
      pad(local.getUTCHours()) +
      pad(local.getUTCMinutes()) +
      "00Z";
    return utc;
  }

  function googleCalendarUrl(task){
    const text = (task.text || "Aufgabe").trim();
    const details = task.quadTitle ? `Quadrant: ${task.quadTitle}` : "Eisenhower-Matrix";

    const base = "https://calendar.google.com/calendar/render?action=TEMPLATE";
    // wenn kein Datum: heute
    const date = task.due || new Date().toISOString().slice(0,10);
    const time = task.time || "09:00";
    const durMin = Number(task.durationMin || 30);

    // Endzeit berechnen
    const [y,m,d] = date.split("-").map(Number);
    const [hh,mm] = time.split(":").map(Number);
    const startLocal = new Date(y, m-1, d, hh, mm, 0);
    const endLocal = new Date(startLocal.getTime() + durMin*60*1000);

    const pad = (n)=> String(n).padStart(2,"0");
    const endDateStr =
      String(endLocal.getFullYear()).padStart(4,"0") + "-" +
      pad(endLocal.getMonth()+1) + "-" +
      pad(endLocal.getDate());
    const endTimeStr = pad(endLocal.getHours()) + ":" + pad(endLocal.getMinutes());

    const dates = `${toGoogleDateTimeUTC(date, time)}/${toGoogleDateTimeUTC(endDateStr, endTimeStr)}`;

    return `${base}&text=${encodeURIComponent(text)}&details=${encodeURIComponent(details)}&dates=${encodeURIComponent(dates)}`;
  }

  // Drag & Drop
  let dragPayload = null; // { fromKey, taskId }
  function onDragStart(e, fromKey, taskId){
    dragPayload = { fromKey, taskId };
    e.dataTransfer.effectAllowed = "move";
    e.dataTransfer.setData("text/plain", JSON.stringify(dragPayload));
    e.currentTarget.classList.add("dragging");
  }
  function onDragEnd(e){
    e.currentTarget.classList.remove("dragging");
    dragPayload = null;
    document.querySelectorAll("ul.tasks.dropTarget").forEach(u=>u.classList.remove("dropTarget"));
  }

  function getTaskIndexById(arr, id){ return arr.findIndex(t=>t.id===id); }

  function moveTask({fromKey, toKey, taskId, beforeTaskId=null}){
    if (!fromKey || !toKey || !taskId) return;

    const fromArr = state[fromKey] || [];
    const idx = getTaskIndexById(fromArr, taskId);
    if (idx<0) return;

    const [task] = fromArr.splice(idx,1);
    task.quadTitle = QUADS.find(q=>q.key===toKey)?.title || task.quadTitle;
    ensureOrder(task);

    const toArr = state[toKey] || (state[toKey]=[]);
    if (beforeTaskId){
      const bIdx = getTaskIndexById(toArr, beforeTaskId);
      if (bIdx >= 0){
        toArr.splice(bIdx,0,task);
        renumberOrders(toKey);
        return;
      }
    }
    toArr.push(task);
    renumberOrders(toKey);
  }

  function renumberOrders(key){
    const arr = state[key] || [];
    let seq = state._seq || 0;
    for (const t of arr){
      seq += 1;
      t.order = seq;
      if (!t.quadTitle) t.quadTitle = QUADS.find(q=>q.key===key)?.title || "";
    }
    state._seq = seq;
    markDirtyAndMaybeAutosave();
    render();
  }

  function allowDrop(e){ e.preventDefault(); e.dataTransfer.dropEffect = "move"; }

  function handleDropToList(e, toKey){
    e.preventDefault();
    const raw = e.dataTransfer.getData("text/plain");
    let p = dragPayload;
    try{ if (raw) p = JSON.parse(raw); }catch{}
    if (!p) return;
    moveTask({ fromKey:p.fromKey, toKey, taskId:p.taskId, beforeTaskId:null });
  }

  function handleDropBeforeTask(e, toKey, beforeTaskId){
    e.preventDefault();
    const raw = e.dataTransfer.getData("text/plain");
    let p = dragPayload;
    try{ if (raw) p = JSON.parse(raw); }catch{}
    if (!p) return;
    moveTask({ fromKey:p.fromKey, toKey, taskId:p.taskId, beforeTaskId });
  }

  function render(){
    els.grid.innerHTML = "";

    for (const q of QUADS){
      const section = document.createElement("section");
      section.className = `card ${q.className}`;

      section.innerHTML = `
        <div class="cardHead">
          <div class="label">
            <strong>${q.title}</strong>
            <div class="hint">${q.hint}</div>
          </div>
          <span class="colorBadge" style="background: var(${q.colorVar});"></span>
        </div>
        <div class="cardBody">
          <div class="addRow">
            <input type="text" id="${q.key}_newtext" placeholder="Neue Aufgabeâ€¦" />
            <input type="date" id="${q.key}_newdue" title="Datum" />
            <input type="time" id="${q.key}_newtime" title="Uhrzeit" />
            <input type="number" id="${q.key}_newdur" title="Dauer (Min.)" min="5" step="5" value="30" />
            <button class="primary" id="${q.key}_add">HinzufÃ¼gen</button>
          </div>
          <ul class="tasks" id="${q.key}_list" data-quad="${q.key}"></ul>
        </div>
      `;
      els.grid.appendChild(section);

      const list = section.querySelector(`#${q.key}_list`);
      const addBtn = section.querySelector(`#${q.key}_add`);
      const newText = section.querySelector(`#${q.key}_newtext`);
      const newDue  = section.querySelector(`#${q.key}_newdue`);
      const newTime = section.querySelector(`#${q.key}_newtime`);
      const newDur  = section.querySelector(`#${q.key}_newdur`);

      // default time suggestion
      if (!newTime.value) newTime.value = "09:00";

      // Drop-Zone
      list.addEventListener("dragover", (e)=>{ allowDrop(e); list.classList.add("dropTarget"); });
      list.addEventListener("dragleave", ()=> list.classList.remove("dropTarget"));
      list.addEventListener("drop", (e)=>{ list.classList.remove("dropTarget"); handleDropToList(e, q.key); });

      const tasksSorted = sortTasks(state[q.key] || []);
      for (const task of tasksSorted){
        ensureOrder(task);
        if (!task.id) task.id = uid();
        task.quadTitle = q.title;

        const li = document.createElement("li");
        li.className = "task" + (task.done ? " done" : "");
        li.draggable = true;

        const metaParts = [];
        if (task.due) metaParts.push(`Datum: ${task.due}`);
        if (task.time) metaParts.push(`Uhrzeit: ${task.time}`);
        if (task.durationMin) metaParts.push(`Dauer: ${task.durationMin} min`);
        const meta = metaParts.length ? metaParts.join(" Â· ") : "Kein Termin";

        li.innerHTML = `
          <div class="tLeft">
            <input type="checkbox" ${task.done ? "checked":""} aria-label="Erledigt" />
            <div class="tTextWrap">
              <div class="tText"></div>
              <div class="tMeta"><span>${meta}</span></div>
            </div>
          </div>
          <div class="tRight">
            <button class="iconBtn" title="In Google Kalender eintragen">ðŸ“…</button>
            <button class="iconBtn danger" title="LÃ¶schen">âœ•</button>
          </div>
        `;
        li.querySelector(".tText").textContent = task.text || "";

        li.addEventListener("dragstart", (e)=> onDragStart(e, q.key, task.id));
        li.addEventListener("dragend", onDragEnd);
        li.addEventListener("dragover", (e)=> allowDrop(e));
        li.addEventListener("drop", (e)=> handleDropBeforeTask(e, q.key, task.id));

        li.querySelector('input[type="checkbox"]').addEventListener("change", (e)=>{
          task.done = !!e.target.checked;
          markDirtyAndMaybeAutosave();
          render();
        });

        li.querySelector('button[title="In Google Kalender eintragen"]').addEventListener("click", ()=>{
          const url = googleCalendarUrl(task);
          window.open(url, "_blank", "noopener");
        });

        li.querySelector('button[title="LÃ¶schen"]').addEventListener("click", ()=>{
          state[q.key] = (state[q.key] || []).filter(t=>t.id!==task.id);
          markDirtyAndMaybeAutosave();
          render();
        });

        list.appendChild(li);
      }

      function addTask(){
        const text = (newText.value || "").trim();
        const due = newDue.value || "";
        const time = newTime.value || "";
        const durationMin = Number(newDur.value || 30);

        if (!text) return;

        state[q.key] = state[q.key] || [];
        state._seq = (state._seq || 0) + 1;

        state[q.key].push({
          id: uid(),
          text,
          due,
          time,
          durationMin: Math.max(5, durationMin),
          done:false,
          order: state._seq,
          quadTitle: q.title
        });

        newText.value = "";
        // Datum/Uhrzeit/Dauer absichtlich beibehalten (schnelles Hintereinander-Eintragen)
        markDirtyAndMaybeAutosave();
        render();
      }

      addBtn.addEventListener("click", addTask);
      newText.addEventListener("keydown", (e)=>{
        if (e.key==="Enter"){ e.preventDefault(); addTask(); }
      });
    }

    if (state._lastSaved) els.lastSaved.textContent = state._lastSaved;
  }

  function exportJSON(){
    const payload = { version: 3, exportedAt: new Date().toISOString(), data: state };
    const blob = new Blob([JSON.stringify(payload, null, 2)], { type:"application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `eisenhower-backup-${new Date().toISOString().replace(/[:.]/g,"-")}.json`;
    a.click();
    URL.revokeObjectURL(url);
  }

  function importJSON(file){
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const payload = JSON.parse(reader.result);
        if (!payload || !payload.data) throw new Error("UngÃ¼ltig");
        state = payload.data;
        if (!state.q1 || !state.q2 || !state.q3 || !state.q4) throw new Error("Struktur fehlt");
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        setSavingUi("gespeichert");
        render();
      }catch{
        alert("Import fehlgeschlagen (keine gÃ¼ltige Sicherung).");
      }
    };
    reader.readAsText(file);
  }

  function clearAll(){
    if (!confirm("Lokale Daten fÃ¼r diese App wirklich lÃ¶schen?")) return;
    localStorage.removeItem(STORAGE_KEY);
    state = defaultState();
    els.lastSaved.textContent = "â€“";
    setSavingUi("bereit");
    render();
  }

  let footerTimer = null;
  function toggleFooter(){ els.footer.classList.toggle("open"); }
  function openFooterTemporarily(){
    els.footer.classList.add("open");
    clearTimeout(footerTimer);
    footerTimer = setTimeout(()=> els.footer.classList.remove("open"), 1500);
  }

  els.menuBtn.addEventListener("click", toggleFooter);
  els.saveBtn.addEventListener("click", ()=> saveStateToStorage());
  els.exportBtn.addEventListener("click", exportJSON);
  els.importBtn.addEventListener("click", ()=> els.fileInput.click());
  els.fileInput.addEventListener("change", (e)=>{
    const f = e.target.files && e.target.files[0];
    if (f) importJSON(f);
    e.target.value = "";
  });
  els.clearBtn.addEventListener("click", clearAll);

  els.aboutLink.addEventListener("click", ()=>{
    alert(
      "Kurzinfo:\n" +
      "- Sortierung nach Datum+Uhrzeit (ohne Termin unten).\n" +
      "- Drag&Drop zwischen Quadranten.\n" +
      "- ðŸ“… Ã¶ffnet Google Kalender mit Start/Ende.\n" +
      "- Export/Import = Backup."
    );
  });

  if (state._lastSaved) els.lastSaved.textContent = state._lastSaved;
  setSavingUi("bereit");
  render();
</script>
</body>
</html>
